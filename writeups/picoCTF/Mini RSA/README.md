
# Mini RSA 

### Author: Sara

### Description

```
Category: Cryptography

What happens if you have a small exponent? There is a twist though, we padded the plaintext so that (M ** e) is just barely larger than N. Let's decrypt this: <a href='//mercury.picoctf.net/static/387dc6431820338cc74324cc5cc9550f/ciphertext'>ciphertext</a>

Hints:

(1) RSA <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)">tutorial</a>

(2) How could having too small of an <code>e</code> affect the security of this key?

(3) Make sure you don't lose precision, the numbers are pretty big (besides the <code>e</code> value)

(4) You shouldn't have to make <i>too</i> many guesses

(5) <code>pico</code> is in the flag, but not at the beginning

```

### Solution

We notice that the exponent is very small. To attack a small exponent in RSA, we can simply bruteforce for the message. As `m ** e = c mod n`, we can represent `m ** e` as `n * x + c` for some unknown `x` (we bruteforce for this). If the e'th root (here cube root) is an integer (i.e. `n * x + c` is a perfect power of the message `m` raised to the exponent `e`), then we have our message.

```bash
â”Œâ”€â”€(arrow ðŸ’€)-[~/Desktop/ctf/picoctf/Mini RSA]
â””â”€$ cat ciphertext 
N: 1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287
e: 3

ciphertext (c): 1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808146956044568639690002921620304969196755223769438221859424275683828638207433071955615349052424040706261639770492033970498727183446507482899334169592311953247661557664109356372049286283480939368007035616954029177541731719684026988849403756133033533171081378815289443019437298879607294287249591634702823432448559878065453908423094452047188125358790554039587941488937855941604809869090304206028751113018999782990033393577325766685647733181521675994939066814158759362046052998582186178682593597175186539419118605277037256659707217066953121398700583644564201414551200278389319378027058801216150663695102005048597466358061508725332471930736629781191567057009302022382219283560795941554288119544255055962
```

Here's the script to bruteforce:

```python
#!/usr/bin/env python3

from Crypto.Util.number import long_to_bytes

n = 1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287
e = 3
c = 1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808146956044568639690002921620304969196755223769438221859424275683828638207433071955615349052424040706261639770492033970498727183446507482899334169592311953247661557664109356372049286283480939368007035616954029177541731719684026988849403756133033533171081378815289443019437298879607294287249591634702823432448559878065453908423094452047188125358790554039587941488937855941604809869090304206028751113018999782990033393577325766685647733181521675994939066814158759362046052998582186178682593597175186539419118605277037256659707217066953121398700583644564201414551200278389319378027058801216150663695102005048597466358061508725332471930736629781191567057009302022382219283560795941554288119544255055962

def cube_root (x: int) -> int:
    low = 0
    high = x
    while low < high:
        mid = (low + high) // 2
        if pow(mid, e) < x:
            low = mid + 1
        else:
            high = mid
    return low

# m ** e = c mod n
# m ** e = n * x + c
# m = root(n * x + c, e)

x = 0
while True:
    if x % 100 == 0:
        print(x)
    y = n * x + c
    m = cube_root(y)
    if pow(m, e) == y:
        break
    x += 1

print(x, long_to_bytes(m))
```

```bash
â”Œâ”€â”€(arrow ðŸ’€)-[~/Desktop/ctf/picoctf/Mini RSA]
â””â”€$ python3 main.py
0
100
200
300
400
500
600
700
800
900
1000
1100
1200
1300
1400
1500
1600
1700
1800
1900
2000
2100
2200
2300
2400
2500
2600
2700
2800
2900
3000
3100
3200
3300
3400
3500
3533 b'picoCTF{e_sh0u1d_b3_lArg3r_6e2e6bda}'
```

##### Flag: `picoCTF{e_sh0u1d_b3_lArg3r_6e2e6bda}`
